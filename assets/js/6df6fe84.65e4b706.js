"use strict";(self.webpackChunkoverture_how_to=self.webpackChunkoverture_how_to||[]).push([[886],{7649:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>s,metadata:()=>i,toc:()=>l});var r=t(5893),a=t(1151);const s={title:"Querying Data in the Cloud"},o=void 0,i={id:"accessing-data/cloud-services",title:"Querying Data in the Cloud",description:"You can access and query Overture parquet files directly in the cloud using one of the SQL query options documented below. You'll need an AWS account or a Microsoft Azure account.",source:"@site/docs/accessing-data/cloud-services.mdx",sourceDirName:"accessing-data",slug:"/accessing-data/cloud-services",permalink:"/how-to/accessing-data/cloud-services",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Querying Data in the Cloud"},sidebar:"docs",previous:{title:"Getting Overture Data",permalink:"/how-to/accessing-data/"},next:{title:"Querying Data Locally",permalink:"/how-to/accessing-data/locally"}},c={},l=[{value:"Amazon Athena",id:"amazon-athena",level:2},{value:"Microsft Synapse",id:"microsft-synapse",level:2}];function u(e){const n={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,a.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"You can access and query Overture parquet files directly in the cloud using one of the SQL query options documented below. You'll need an AWS account or a Microsoft Azure account."}),"\n",(0,r.jsx)(n.h2,{id:"amazon-athena",children:"Amazon Athena"}),"\n",(0,r.jsx)(n.p,{children:"Run the set-up query below in the Athena Query Console. It will create tables in your AWS account's data catalog pointing directly to data hosted on Overture's S3 bucket. You can then query Overture data directly from Athena without needing to copy it."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"TIP: Athena only allows one SQL statement to be run at a time, so highlight and run each SQL query separately."}),"\n",(0,r.jsxs)(n.li,{children:["TIP: Overture's S3 bucket is located in the us-west-2 AWS region, so use Athena in ",(0,r.jsx)(n.code,{children:"us-west-2"})," for best performance."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"    CREATE EXTERNAL TABLE `overture`(\n        `categories` struct<main:string,alternate:array<string>>,\n        `level` int,\n        `socials` array<string>,\n        `subtype` string,\n        `numfloors` int,\n        `entityid` string,\n        `class` string,\n        `sourcetags` map<string,string>,\n        `localitytype` string,\n        `emails` array<string>,\n        `drivingside` string,\n        `adminlevel` int,\n        `road` string,\n        `isocountrycodealpha2` string,\n        `isosubcountrycode` string,\n        `updatetime` string,\n        `wikidata` string,\n        `confidence` double,\n        `defaultlanguage` string,\n        `brand` struct<names:struct<common:array<struct<value:string,language:string>>,official:array<struct<value:string,language:string>>,alternate:array<struct<value:string,language:string>>,short:array<struct<value:string,language:string>>>,wikidata:string>,\n        `addresses` array<struct<freeform:string,locality:string,postCode:string,region:string,country:string>>,\n        `names` struct<common:array<struct<value:string,language:string>>,official:array<struct<value:string,language:string>>,alternate:array<struct<value:string,language:string>>,short:array<struct<value:string,language:string>>>,\n        `isintermittent` boolean,\n        `connectors` array<string>,\n        `surface` string,\n        `version` int,\n        `phones` array<string>,\n        `id` string,\n        `geometry` binary,\n        `context` string,\n        `height` double,\n        `maritime` boolean,\n        `sources` array<struct<property:string,dataset:string,recordId:string,confidence:double>>,\n        `websites` array<string>,\n        `issalt` boolean,\n        `bbox` struct<minx:double,maxx:double,miny:double,maxy:double>)\n    PARTITIONED BY (\n        `theme` string,\n        `type` string)\n    STORED AS PARQUET\n    LOCATION\n        's3://overturemaps-us-west-2/release/2024-02-15-alpha.0'\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"4",children:["\n",(0,r.jsxs)(n.li,{children:["After you run the set-up query, you can load the partitions by running ",(0,r.jsx)(n.code,{children:"MSCK REPAIR TABLE overture"}),' or choosing "Load Partitions" from the table options menu.']}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Example Athena SQL query to download a CSV of places in Seattle:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT\n       CAST(names AS JSON),\n       geometry -- WKB\nFROM\n       places\nWHERE\n       bbox.minX > -122.4447744\n   AND bbox.maxX < -122.2477071\n   AND bbox.minY > 47.5621587\n   AND bbox.maxY < 47.7120663\n"})}),"\n",(0,r.jsxs)(n.p,{children:["More information on using Athena is available in the ",(0,r.jsx)(n.a,{href:"https://docs.aws.amazon.com/athena/latest/ug/what-is.html",children:"Amazon Athena User Guide"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"microsft-synapse",children:"Microsft Synapse"}),"\n",(0,r.jsxs)(n.p,{children:["In your Azure account, create a ",(0,r.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/synapse-analytics/get-started-create-workspace",children:"Synapse workspace"}),". You can then run this SQL query to read places in Seattle:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"    SELECT TOP 10 *\n    FROM\n        OPENROWSET(\n            BULK 'https://overturemapswestus2.blob.core.windows.net/release/2024-02-15-alpha.0/theme=places/type=place/',\n            FORMAT = 'PARQUET'\n        )\n    WITH\n        (\n            names VARCHAR(MAX),\n            categories VARCHAR(MAX),\n            websites VARCHAR(MAX),\n            phones VARCHAR(MAX),\n            bbox VARCHAR(200),\n            geometry VARBINARY(MAX)\n        )\n       AS\n            [result]\n    WHERE\n            TRY_CONVERT(FLOAT, JSON_VALUE(bbox, '$.minx')) > -122.4447744\n        AND TRY_CONVERT(FLOAT, JSON_VALUE(bbox, '$.maxx')) < -122.2477071\n        AND TRY_CONVERT(FLOAT, JSON_VALUE(bbox, '$.miny')) > 47.5621587\n        AND TRY_CONVERT(FLOAT, JSON_VALUE(bbox, '$.maxy')) < 47.7120663\n"})}),"\n",(0,r.jsxs)(n.p,{children:["More information is available at ",(0,r.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/training/modules/query-data-lake-using-azure-synapse-serverless-sql-pools/3-query-files",children:'"Query files using a serverless SQL pool"'})," on Microsoft Learn."]})]})}function d(e={}){const{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>i,a:()=>o});var r=t(7294);const a={},s=r.createContext(a);function o(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);