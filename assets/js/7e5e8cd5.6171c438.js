"use strict";(self.webpackChunkoverture_documentation=self.webpackChunkoverture_documentation||[]).push([[5499],{2594:(e,s,n)=>{n.d(s,{A:()=>i});var t=n(58069),r=n(40797),a=n(74848);function i(e){const{siteConfig:{customFields:s}}=(0,r.A)();var n=e.query.replaceAll("__OVERTURE_RELEASE",s.overtureRelease);n=(n=n.replaceAll("__ATHENA_OVERTURE_RELEASE","v"+s.overtureRelease.replaceAll(".","_").replaceAll("-","_"))).replaceAll("__PMTILES_OVERTURE_RELEASE",s.overtureRelease.split(".",1));var i=e.language||"sql";return(0,a.jsx)(t.default,{language:i,title:e.title,children:n})}},48337:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>o,default:()=>c,frontMatter:()=>i,metadata:()=>t,toc:()=>l});var t=n(65087),r=n(74848),a=n(28453);n(2594);const i={title:'Using the GERS "system"'},o=void 0,d={authorsImageUrls:[]},l=[{value:"Understanding GERS IDs",id:"understanding-gers-ids",level:2},{value:"Exploring Overture&#39;s <code>divisions</code> and <code>hierarchies</code> with GERS",id:"exploring-overtures-divisions-and-hierarchies-with-gers",level:2},{value:"2. Looking up IDs in the GERS Registry",id:"2-looking-up-ids-in-the-gers-registry",level:2},{value:"3. Using the data changelog",id:"3-using-the-data-changelog",level:2},{value:"4. Using bridge files",id:"4-using-bridge-files",level:2},{value:"5. Next steps",id:"5-next-steps",level:2}];function h(e){const s={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components},{Details:n}=s;return n||function(e,s){throw new Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s.p,{children:["With the June release, we introduced several updated and new components of our Global Entity Reference System (GERS), including a ",(0,r.jsx)(s.a,{href:"https://github.com/orgs/OvertureMaps/discussions/390",children:"new format for GERS IDs"})," and a new ",(0,r.jsx)(s.a,{href:"/gers/registry",children:"GERS Registry"}),'. In this blog post, we\'ll walk you through the components of the GERS "system" show you how to ask new questions of Overture data.']}),"\n",(0,r.jsx)(s.h2,{id:"understanding-gers-ids",children:"Understanding GERS IDs"}),"\n",(0,r.jsxs)(s.p,{children:["As of the June 2025 release, all GERS IDs are UUIDs: 128-bit, randomly-generated identifiers (",(0,r.jsx)(s.a,{href:"https://datatracker.ietf.org/doc/html/rfc4122",children:"UUID v4"}),") that Overture keeps stable across data releases and updates. These IDs are stored as strings with dashes: ",(0,r.jsx)(s.code,{children:"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"}),"."]}),"\n",(0,r.jsxs)(s.p,{children:["For this release only, we're providing Parquet files that map GERS IDs from the May release to the new GERS UUIDs in June release. These files are partitioned by ",(0,r.jsx)(s.code,{children:"theme"})," and 'type' and can be accessed here: ",(0,r.jsx)(s.code,{children:"s3://overturemaps-extras-us-west-2/june_to_may_id_mapping/"})]}),"\n",(0,r.jsxs)(s.h2,{id:"exploring-overtures-divisions-and-hierarchies-with-gers",children:["Exploring Overture's ",(0,r.jsx)(s.code,{children:"divisions"})," and ",(0,r.jsx)(s.code,{children:"hierarchies"})," with GERS"]}),"\n",(0,r.jsxs)(s.p,{children:["Let's start by exploring how GERS IDs work in one Overture dataset. The ",(0,r.jsx)(s.code,{children:"divisions"})," theme contains administrative boundaries and points for global administrative areas. In this example, we'll use DuckDB to connect to Azure and read the Parquet files from Azure blob storage. You can also access the files on Amazon S3."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"CREATE TABLE slc AS (\n    SELECT\n        *\n    FROM\n        read_parquet('az://overturemapswestus2.blob.core.windows.net/release/2025-06-25.0/theme=divisions/type=division/*')\n    WHERE\n        -- ID for Salt Lake City, Utah\n        id = 'c85948de-26de-4c4a-8479-1dac33fa8b04'\n);\n"})}),"\n",(0,r.jsxs)(s.p,{children:["When we query that table, we can see the ",(0,r.jsx)(s.code,{children:"divisions"})," hierarchy: Salt Lake City is a locality in Salt Lake County, which is in the region of Utah, within the country of the United States."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"SELECT\n    h.name,\n    h.subtype,\n    h.division_id\nFROM\n    slc\nCROSS JOIN UNNEST(hierarchies[1]) AS t(h);\n"})}),"\n",(0,r.jsxs)(s.p,{children:["If we wanted to retrieve the actual polygons for the administrative boundaries, we can search the ",(0,r.jsx)(s.code,{children:"division_area"})," type of the ",(0,r.jsx)(s.code,{children:"divisions"})," theme to obtain these particular ",(0,r.jsx)(s.code,{children:"division"})," IDs:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"COPY(\n    SELECT\n        names.primary AS name,\n        subtype,\n        id,\n        geometry\n    FROM\n        read_parquet('az://overturemapswestus2.blob.core.windows.net/release/2025-06-25.0/theme=divisions/type=division_area/*') areas\n    WHERE\n        division_id IN (\n            SELECT\n                h.division_id\n            FROM\n                slc\n            CROSS JOIN UNNEST(hierarchies[1]) AS t(h)\n        )\n) TO 'slc_hierarchies.geojson' WITH (FORMAT GDAL, DRIVER GeoJSON);\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Next we'll load ",(0,r.jsx)(s.code,{children:"slc_hierarchies.geojson"})," into ",(0,r.jsx)(s.a,{href:"https://kepler.gl/",children:"KeplerGL"})," so that we can see the complete hierarchy of divisions."]}),"\n",(0,r.jsx)(s.p,{children:"GERS IDs are intended to be the key to unlock interoperability both inside and outside of Overture data. This example showed how Overture features within the same theme can reference one-another via GERS."}),"\n",(0,r.jsx)(s.h2,{id:"2-looking-up-ids-in-the-gers-registry",children:"2. Looking up IDs in the GERS Registry"}),"\n",(0,r.jsx)(s.p,{children:"Let's grab the GERS IDs for a couple landmarks and places in Salt Lake City and look them up in the GERS Registry."}),"\n",(0,r.jsxs)(n,{children:[(0,r.jsx)("summary",{children:(0,r.jsxs)(s.p,{children:["The UUID for the Utah State Capitol is ",(0,r.jsx)(s.code,{children:"d724e74f-017a-4902-9031-bc784ffc1789"}),". Is that part of GERS?"]})}),(0,r.jsxs)(s.p,{children:["Yes! We can search for that ",(0,r.jsx)(s.code,{children:"id"})," in the GERS Registry with this query:"]}),(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"SELECT \n   *\nFROM read_parquet('https://overturemapswestus2.blob.core.windows.net/registry/2025-06.25.0/')    \nWHERE id='d724e74f-017a-4902-9031-bc784ffc1789';\n"})}),(0,r.jsxs)(s.p,{children:["We can see that it's a ",(0,r.jsx)(s.code,{children:"place"})," type that was first seen by the ",(0,r.jsx)(s.a,{href:"https://docs.overturemaps.org/gers/registry/",children:"GERS Registry"})," in June 2025. This makes sense because the GERS Registry didn't exist to ",(0,r.jsx)(s.em,{children:"see"})," any features before that."]})]}),"\n",(0,r.jsx)(n,{children:(0,r.jsx)("summary",{children:(0,r.jsx)(s.p,{children:"What's the UUID for the Great Salt Lake? Is it part of the GERS Registry?"})})}),"\n",(0,r.jsx)(s.h2,{id:"3-using-the-data-changelog",children:"3. Using the data changelog"}),"\n",(0,r.jsx)(s.admonition,{type:"note",children:(0,r.jsxs)(s.p,{children:["For the next part of this tutorial, we're using artifacts from the May release (",(0,r.jsx)(s.code,{children:"2025-05-21.0"}),"). Because of the switch to UUIDs in June, we did not generate a changelog in June. The next changelog will be published with the July release."]})}),"\n",(0,r.jsxs)(s.p,{children:["Every Overture release (except the June 2025 release) includes a ",(0,r.jsx)(s.a,{href:"https://docs.overturemaps.org/gers/changelog/",children:"changelog"})," with a high level overview of data added, removed, or changed, based on the ID. The changelog is partitioned by ",(0,r.jsx)(s.code,{children:"theme"}),", ",(0,r.jsx)(s.code,{children:"type"}),", and ",(0,r.jsx)(s.code,{children:"change_type"}),". Let's use the changelog to identify all of the features added in Salt Lake City in Overture's May release."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"SELECT\n    id\nFROM\n    read_parquet('s3://overturemaps-us-west-2/changelog/2025-05-21.0/theme=places/*/*/*.parquet')\nWHERE\n    change_type = 'added'\n    AND bbox.xmin > -112.461 AND bbox.xmax < -111.073\n    AND bbox.ymin > 40.296 AND bbox.ymax < 40.955\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Next we can join this list of new places to the ",(0,r.jsx)(s.code,{children:"places"})," theme by ",(0,r.jsx)(s.code,{children:"id"})," and write out a new GeoJSON file:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"COPY(\n    SELECT\n        places.id as id,\n        names.primary as name,\n        categories.primary as category,\n        confidence,\n        CAST(sources AS JSON) as sources,\n        geometry\n    FROM\n        read_parquet('s3://overturemaps-us-west-2/release/2025-05-21.0/theme=places/type=place/*') places\n    JOIN (\n        SELECT\n            id\n        FROM\n            read_parquet('s3://overturemaps-us-west-2/changelog/2025-05-21.0/theme=places/*/*/*.parquet')\n        WHERE change_type = 'added'\n        AND bbox.xmin > -112.461 AND bbox.xmax < -111.073 AND bbox.ymin > 40.296 AND bbox.ymax < 40.955\n        ) changelog\n    ON places.id = changelog.id\n    ORDER BY places.id ASC\n) TO 'new_places_slc_may.geojson' WITH (FORMAT GDAL, DRIVER GeoJSON);\n"})}),"\n",(0,r.jsx)(s.p,{children:"We could go one step further and query the one-time May to June ID mapping to translate our list of IDs from the May release to the new UUIDs in June. Here's how we would do that:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:" COPY (SELECT\n        id\n    FROM\n        read_parquet('s3://overturemaps-us-west-2/changelog/2025-05-21.0/theme=places/*/*/*.parquet')\n    WHERE\n        change_type = 'added'\n        AND bbox.xmin > -112.461 AND bbox.xmax < -111.073\n        AND bbox.ymin > 40.296 AND bbox.ymax < 40.955\n    ) TO 'added_places_slc_may.parquet'\n\n\n CREATE TABLE IF NOT EXISTS oldIDs AS\n (SELECT\n oldIDs.id\n FROM read_parquet('added_places_slc_may.parquet')\n JOIN\n (SELECT \n * \n FROM read_parquet ('s3://overturemaps-extras-us-west-2/june_to_may_id_mapping/theme=places/type=place/*'') newUUIDs\n ON \n oldIDs.id = newUUIDs.previous_id\n TO 'added_places_slc_june.geojson' WITH (FORMAT GDAL, DRIVER GeoJSON);\n\n"})}),"\n",(0,r.jsx)(s.h2,{id:"4-using-bridge-files",children:"4. Using bridge files"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.a,{href:"https://docs.overturemaps.org/gers/bridge-files/",children:"Bridge files"})," are published mappings of GERS ID to Source IDs for Overture features that came from an established dataset with a meaningful ",(0,r.jsx)(s.code,{children:"record_id"}),". ML-Derived buildings, for example, do not have stable meaningful input IDs, but place records from Meta have corresponding IDs that reference public Facebook pages."]}),"\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"sources"})," property lists the original source of the data and any additional properties that Overture has added. We can use the bridge file for Meta's places data to map the GERS ID back to the source ID. Then we can look upthe Facebook pages for the new places in Salt Lake City:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"COPY(\n    SELECT\n        'https://facebook.com/' || cast(bridge.record_id as varchar) AS facebook_page,\n        slc_places.*\n    FROM ST_READ('results/new_places_slc.geojson') slc_places JOIN (\n        SELECT\n            id,\n            record_id\n        FROM\n            read_parquet('s3://overturemaps-us-west-2/bridgefiles/2025-05-21.0/dataset=meta/theme=places/type=place/*')\n    ) bridge ON slc_places.id = bridge.id\n    LIMIT 100\n) TO 'results/new_places_slc_with_fb_pages.geojson' WITH (FORMAT GDAL, Driver GeoJSON);\n"})}),"\n",(0,r.jsx)(s.h2,{id:"5-next-steps",children:"5. Next steps"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Checkout our ",(0,r.jsx)(s.a,{href:"https://docs.overturemaps.org/gers/gers-tutorial/",children:"GERS tutorial"})]}),"\n",(0,r.jsxs)(s.li,{children:["Read more about the components of GERS in our ",(0,r.jsx)(s.a,{href:"https://docs.overturemaps.org/gers/",children:"docs"})]}),"\n",(0,r.jsxs)(s.li,{children:["Read our ",(0,r.jsx)(s.a,{href:"https://overturemaps.org/blog/2025/understanding-overtures-global-entity-reference-system/",children:'"GERS Deep Dive"'})," and ",(0,r.jsx)(s.a,{href:"https://overturemaps.org/blog/2025/introducing-bridge-files/",children:'"Introducing Bridge Files"'})," blog posts"]}),"\n"]})]})}function c(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},65087:e=>{e.exports=JSON.parse('{"permalink":"/blog/2025/06/25/getting-started-gers","source":"@site/blog/2025-06-25-getting-started-gers.mdx","title":"Using the GERS \\"system\\"","description":"With the June release, we introduced several updated and new components of our Global Entity Reference System (GERS), including a new format for GERS IDs and a new GERS Registry. In this blog post, we\'ll walk you through the components of the GERS \\"system\\" show you how to ask new questions of Overture data.","date":"2025-06-25T00:00:00.000Z","tags":[],"readingTime":4.96,"hasTruncateMarker":false,"authors":[],"frontMatter":{"title":"Using the GERS \\"system\\""},"unlisted":false,"nextItem":{"title":"2025-06-25.0 release notes","permalink":"/blog/2025-06-25.0"}}')}}]);